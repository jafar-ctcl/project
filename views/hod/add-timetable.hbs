
<section>
    <div class="container py-4 border bg-light">
        <h2 class="text-center mb-5 text-primary">Create Timetable</h2>
        <!-- Display Flash Success Message -->
    {{#if day}}
      <div class="{{year}}alert alert-success">
        {{year}}{{day}}
      </div>
    {{/if}}
        <!-- Timetable Creation Form -->
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <form action="/hod/add-timetable" method="POST">
                    <!-- Class Selection -->
                    <div class="mb-4">
                        <label class="form-label fs-5">Select Year</label>
                        <select class="form-select custom-select" name="year" required>
                            <option value="">Choose a Year...</option>
                            <option value="1">1 Year</option>
                            <option value="2">2 Year</option>
                            <option value="3">3 Year</option>
                        </select>
                    </div>

                    <!-- Day Selection -->
                    <div class="mb-4">
                        <label for="daySelect" class="form-label fs-5">Day</label>
                        <select id="daySelect" class="form-select custom-select" name="day" required>
                            <option value="">Choose a day...</option>
                            <option value="monday">Monday</option>
                            <option value="tuesday">Tuesday</option>
                            <option value="wednesday">Wednesday</option>
                            <option value="thursday">Thursday</option>
                            <option value="friday">Friday</option>
                        </select>
                    </div>

                    <!-- Time Slot Section -->
                    <div id="timeSlotSection">
                        <div class="time-slot mb-4 border p-4 rounded shadow-sm">
                            <h5 class="text-secondary">Time Slot 1</h5>

                            <!-- Time Slot Input -->
                            <div class="mb-3">
                                <label for="timeSlot1" class="form-label">Time Slot</label>
                                <input type="text" id="timeSlot1" class="form-control custom-input" name="timeslots"
                                    placeholder="eg: 9:30 AM - 10:00 AM" required>
                            </div>

                            <!-- Teacher Selection -->
                            <div class="mb-3">
                                <label class="form-label fs-5">Teacher</label>
                                <select id="teacherDropdown" class="form-select custom-select" name="teachers" required>
                                    <option value="">Choose a teacher...</option>
                                    {{#each teachersInfo}}
                                    <option value="{{this.name}}" data-subjects="{{this.subjects}}">{{this.name}}
                                    </option>
                                    {{/each}}
                                </select>
                            </div>

                            <!-- Subject Dropdown -->
                            <div class="mb-3">
                                <label for="subject" class="form-label fs-5">Subject</label>
                                <select id="subjectDropdown" class="form-select custom-select" name="subjects" required>
                                    <option value="">Choose a subject...</option>
                                </select>
                            </div>


                        </div>
                    </div>

                    <!-- Add/Remove Buttons -->
                    <div class="text-center mb-4">
                        <button type="button" class="btn btn-outline-success me-3" id="addTimeSlot">Add More Time
                            Slots</button>
                        <button type="button" class="btn btn-outline-danger" id="removeTimeSlot">Remove Last
                            Slot</button>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>


<script>
    // Get references to the existing dropdowns
const teacherDropdown = document.getElementById('teacherDropdown');
const subjectDropdown = document.getElementById('subjectDropdown');

// Listen for changes on the teacher dropdown for the first time slot
if (teacherDropdown) {
    teacherDropdown.addEventListener('change', function () {
        updateSubjectDropdown(subjectDropdown, teacherDropdown);
    });
}

// Function to update the subject dropdown based on selected teacher
function updateSubjectDropdown(subjectDropdown, teacherDropdown) {
    // Clear the subject dropdown
    subjectDropdown.innerHTML = '<option value="">Choose a subject...</option>';

    // Get the selected teacher's subjects
    const selectedTeacher = teacherDropdown.options[teacherDropdown.selectedIndex];
    const subjects = selectedTeacher.getAttribute('data-subjects');

    if (subjects) {
        // Split the subjects and populate the dropdown
        const subjectsArray = subjects.split(','); // Assumes subjects are comma-separated
        subjectsArray.forEach((subject) => {
            const option = document.createElement('option');
            option.value = subject.trim();
            option.textContent = subject.trim();
            subjectDropdown.appendChild(option);
        });
    }
}

// Add Time Slot
document.getElementById("addTimeSlot").addEventListener("click", function () {
    const timeSlotSection = document.getElementById("timeSlotSection");
    const timeSlotCount = timeSlotSection.getElementsByClassName("time-slot").length + 1;

  //  if (timeSlotCount <= 5) {
        const newTimeSlot = document.createElement("div");
        newTimeSlot.className = "time-slot mb-4 border p-4 rounded shadow-sm";
        newTimeSlot.innerHTML = `
            <h5 class="text-secondary">Time Slot ${timeSlotCount}</h5>
            <div class="mb-3">
                <label for="timeSlot${timeSlotCount}" class="form-label">Time Slot</label>
                <input type="text" id="timeSlot${timeSlotCount}" class="form-control custom-input" name="timeslots" placeholder="eg: 9:30 AM - 10:00 AM" required>
            </div>
            <div class="mb-3">
                <label class="form-label fs-5">Teacher</label>
                <select class="teacher-dropdown form-select custom-select" name="teachers" required>
                    <option value="">Choose a teacher...</option>
                    {{#each teachersInfo}}
                    <option value="{{this.name}}" data-subjects="{{this.subjects}}">{{this.name}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="mb-3">
                <label for="subject" class="form-label fs-5">Subject</label>
                <select class="subject-dropdown form-select custom-select" name="subjects" required>
                    <option value="">Choose a subject...</option>
                </select>
            </div>
        `;
        timeSlotSection.appendChild(newTimeSlot);

        // Get the newly added dropdowns
        const newTeacherDropdown = newTimeSlot.querySelector(".teacher-dropdown");
        const newSubjectDropdown = newTimeSlot.querySelector(".subject-dropdown");

        // Add event listener for teacher dropdown in the new time slot
        newTeacherDropdown.addEventListener("change", function () {
            updateSubjectDropdown(newSubjectDropdown, newTeacherDropdown);
        });
    /*} else {
        alert("You can only add up to 5 time slots.");
    }*/
});

// Remove Time Slot
document.getElementById("removeTimeSlot").addEventListener("click", function () {
    const timeSlotSection = document.getElementById("timeSlotSection");
    const timeSlots = timeSlotSection.getElementsByClassName("time-slot");
    if (timeSlots.length > 1) {
        timeSlotSection.removeChild(timeSlots[timeSlots.length - 1]);
    } else {
        alert("You must have at least one time slot.");
    }
});



</script>

<style>
    .custom-select,
    .custom-input {
        max-width: 100%;
    }
</style>