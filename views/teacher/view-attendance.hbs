<div class="container mt-5">
  <h2 class="text-center mb-4">View Attendance</h2>
  <!-- Attendance Filter Form -->
  <form id="attendanceForm" method="POST" action="/teacher/view-attendance">
    <div class="row mt-4">
      <div class="col-md-6">
        <label for="courseSelect" class="form-label">Select Year</label>
        <select class="form-select" id="courseSelect" name="year" required>
          <option selected disabled>Choose Year</option>
          <option value="1">1st Year</option>
          <option value="2">2nd Year</option>
          <option value="3">3rd Year</option>
        </select>
      </div>
      <div class="col-md-6">
        <label for="attendanceDate" class="form-label">Select Date</label>
        <input type="date" class="form-control" id="attendanceDate" name="date" required>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-md-12 text-center">
        <button type="submit" class="btn btn-primary">View Attendance</button>
      </div>
    </div>
  </form>

  <!-- Attendance Table -->
  <div class="row mt-4">
    <div class="col-md-12">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Date</th>
            <th>Student Name</th>
            <th>Roll Number</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="attendanceTableBody">
          {{#each attendance}}
            <tr>
              <td>{{day}}</td>
              <td>{{name}}</td>
              <td>{{id}}</td>
              <td>{{status}}</td>
              <td>
                <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#attendanceModal" onclick="editAttendance({{id}}, '{{name}}', '{{status}}')">Edit</button>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal for Editing Attendance -->
  <div class="modal fade" id="attendanceModal" tabindex="-1" aria-labelledby="attendanceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="attendanceModalLabel">Edit Attendance</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editAttendanceForm">
            <div class="mb-3">
              <label for="studentName" class="form-label">Student Name</label>
              <input type="text" class="form-control" id="studentName" disabled>
            </div>
            <div class="mb-3">
              <label for="attendanceStatus" class="form-label">Attendance Status</label>
              <select class="form-select" id="attendanceStatus">
                <option value="present">Present</option>
                <option value="absent">Absent</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // JavaScript to handle the "Edit Attendance" functionality
// JavaScript to handle attendance editing
function editAttendance(id, name, status) {
  document.getElementById('studentName').value = name;
  document.getElementById('attendanceStatus').value = status.toLowerCase();

  // Handle form submission for editing attendance
  document.getElementById('editAttendanceForm').onsubmit = function (e) {
    e.preventDefault(); // Prevent default form submission

    const updatedStatus = document.getElementById('attendanceStatus').value;

    // Send the updated data to the backend
    fetch(`/teacher/edit-attendance/${id}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: id,
        status: updatedStatus,
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
        //  alert('Attendance updated successfully!');
          var modal = bootstrap.Modal.getInstance(document.getElementById('attendanceModal'));
          modal.hide();
          // Optionally, reload the page or refresh the table
          location.reload();
        } else {
          alert('Failed to update attendance');
        }
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('Error updating attendance');
      });
  };
}

</script>